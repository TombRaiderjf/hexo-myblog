<p><em>原创文章，转载请留言，注明出处</em></p>

<h2 id="section">应用</h2>

<p>距离变化于1966年被学者首次提出，目前被广泛应用于图像分析，计算机视觉，模式识别等领域，利用它来实现目标细化，骨架提取，形状插值及匹配，粘连物理的分离。</p>

<h2 id="section-1">原理及实现方法</h2>

<p>距离变换是针对<strong>二值图像</strong>的一种变换，这里的二值图像要确保1是目标像素，0是背景像素。变换的结果是灰度图像，每一点的灰度值代表该点距离目标像素的最小距离（棋盘距离），因此灰度值越小，距离目标像素越近。</p>

<p>对二值图像矩阵进行两次遍历，第一次从上到下，从左到右，利用下面左图的掩模，其中位置p是遍历的像素点。如果AL处的值不全为0，p不为0，则令 p=min(AL)+1 .第二次从下到上，从右到左，利用下面右图的掩模，若p不为0，BR不全为0，则取 p=min(min(BR)+1,p) 即取p和BR+1的最小值。</p>

<p><img src="http://i.imgur.com/i4Xot4P.png" alt="" /> 
<img src="http://i.imgur.com/YY7MD5a.png" alt="" /></p>

<h2 id="section-2">代码</h2>

<p>利用MATLAB编写函数对任意输入图像进行距离变换</p>

<div class="language-matlab highlighter-rouge"><pre class="highlight"><code>	<span class="k">function</span> <span class="p">[</span> <span class="n">img2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">Dist_Tran_img</span><span class="p">(</span> <span class="n">img</span> <span class="p">)</span>
	<span class="c1">%距离变换函数</span>
	<span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>
	<span class="n">level</span> <span class="o">=</span> <span class="n">graythresh</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>  <span class="c1">%选择二值化最优阈值</span>
	<span class="n">img</span> <span class="o">=</span> <span class="n">im2bw</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">level</span><span class="p">);</span>  <span class="c1">%图像二值化</span>
	<span class="n">img1</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">img1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(</span><span class="mi">1</span><span class="p">,:);</span>   <span class="c1">%将img扩大到（x+2*y+2)</span>
	<span class="n">img1</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(</span><span class="n">x</span><span class="p">,:);</span>
	<span class="n">img1</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">img1</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(:,</span><span class="n">y</span><span class="p">);</span>
	<span class="n">img1</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(:,:);</span>
	<span class="n">img1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">img1</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">img1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
	<span class="n">img1</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
	<span class="n">tag</span> <span class="o">=</span> <span class="nb">ones</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">tag</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">img</span><span class="p">;</span>
	<span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span>
    	<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span>
        	<span class="k">if</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">1</span>  <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">1</span>
            	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">),</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            	<span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            	<span class="k">continue</span><span class="p">;</span>
        	<span class="k">end</span>
        	<span class="k">if</span>  <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span><span class="o">~=</span><span class="mi">1</span>
            	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            	<span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            	<span class="k">continue</span><span class="p">;</span>
        	<span class="k">end</span>
        	<span class="k">if</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">~=</span><span class="mi">1</span>
            	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            	<span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        	<span class="k">end</span>
    	<span class="k">end</span>
	<span class="k">end</span>

	<span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span>
    	<span class="k">for</span> <span class="nb">i</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span>
        	<span class="k">if</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span><span class="o">~=</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">~=</span><span class="mi">1</span>
            	<span class="k">if</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">),</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">));</span>
            	<span class="k">else</span>
                	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">),</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                	<span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            	<span class="k">end</span>
            	<span class="k">continue</span><span class="p">;</span>
        	<span class="k">end</span>
        	<span class="k">if</span>  <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span><span class="o">~=</span><span class="mi">1</span>
            	<span class="k">if</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">));</span>
            	<span class="k">else</span>
                	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                	<span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            	<span class="k">end</span>
            	<span class="k">continue</span><span class="p">;</span>
       		<span class="k">end</span>
        	<span class="k">if</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">~=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">~=</span><span class="mi">1</span>
            	<span class="k">if</span> <span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">));</span>
            	<span class="k">else</span>
                	<span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">img1</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                	<span class="n">tag</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            	<span class="k">end</span>
        	<span class="k">end</span>
    	<span class="k">end</span>
	<span class="k">end</span>
	<span class="n">img2</span> <span class="o">=</span> <span class="n">img1</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">img2</span><span class="p">));</span>
	<span class="n">img2</span> <span class="o">=</span> <span class="n">img2</span><span class="p">/</span><span class="n">m</span><span class="p">;</span>
	<span class="k">end</span>
</code></pre>
</div>

<p>测试：原图和距离变换后的图像如下</p>

<p><img src="http://i.imgur.com/8e4vlcq.png" alt="" /></p>

<p><img src="http://i.imgur.com/de9p7ei.png" alt="" /></p>

<p><em>MATLAB Tips: 如果灰度矩阵为double类型，则灰度范围是0-1，如果为unit或int型，则灰度范围为0-255，使用imshow(img)的时候需要注意，否则可能出现图像全黑或全白的情况。</em></p>

